Quiz.combo.ComboBoxDefault=function(e){e=e||{},Ext.applyIf(e,{assertValue:function(){var e,i=this.getRawValue();if(!(e=(e=this.valueField&&Ext.isDefined(this.value)?this.findRecord(this.valueField,this.value):e)&&e.get(this.displayField)!=i?null:e)&&this.forceSelection)0<i.length&&i!=this.emptyText?(this.el.dom.value=Ext.value(this.lastSelectionText,""),this.applyEmptyText()):this.clearValue();else{if(e&&this.valueField){if(this.value==i)return;i=e.get(this.valueField||this.displayField)}this.setValue(i)}}}),Quiz.combo.ComboBoxDefault.superclass.constructor.call(this,e)},Ext.extend(Quiz.combo.ComboBoxDefault,MODx.combo.ComboBox),Ext.reg("quiz-combo-combobox-default",Quiz.combo.ComboBoxDefault),Quiz.combo.Search=function(e){e=e||{},Ext.applyIf(e,{xtype:"twintrigger",ctCls:"x-field-search",allowBlank:!0,msgTarget:"under",emptyText:_("search"),name:"query",triggerAction:"all",clearBtnCls:"x-field-search-clear",searchBtnCls:"x-field-search-go",onTrigger1Click:this._triggerSearch,onTrigger2Click:this._triggerClear}),Quiz.combo.Search.superclass.constructor.call(this,e),this.on("render",function(){this.getEl().addKeyListener(Ext.EventObject.ENTER,function(){this._triggerSearch()},this)}),this.addEvents("clear","search")},Ext.extend(Quiz.combo.Search,Ext.form.TwinTriggerField,{initComponent:function(){Ext.form.TwinTriggerField.superclass.initComponent.call(this),this.triggerConfig={tag:"span",cls:"x-field-search-btns",cn:[{tag:"div",cls:"x-form-trigger "+this.searchBtnCls},{tag:"div",cls:"x-form-trigger "+this.clearBtnCls}]}},_triggerSearch:function(){this.fireEvent("search",this)},_triggerClear:function(){this.fireEvent("clear",this)}}),Ext.reg("quiz-combo-search",Quiz.combo.Search),Quiz.combo.Listbox=function(e){var i=[];e.all&&i.push([_("all"),""]),Ext.isEmpty(e.values)?Ext.isEmpty(e.data)||e.data.split("||").forEach(function(e){e=e.split("==");i.push([e[0],e[1]||e[0]])}):Object.values(e.values).forEach(function(e){i.push([e.name,e.id])}),e=e||{},Ext.applyIf(e,{store:new Ext.data.SimpleStore({fields:["display","value"],data:i}),hiddenName:e.name,displayField:"display",valueField:"value",mode:"local",triggerAction:"all",editable:1,pageSize:20,selectOnFocus:0,preventRender:1}),Quiz.combo.Listbox.superclass.constructor.call(this,e)},Ext.extend(Quiz.combo.Listbox,Quiz.combo.ComboBoxDefault),Ext.reg("quiz-combo-listbox",Quiz.combo.Listbox),Quiz.combo.Resource=function(e){e=e||{},Ext.applyIf(e,{url:Quiz.config.connectorUrl,name:"resource",hiddenName:e.name,id:Ext.id(),fieldLabel:_("resource"),fields:["id","pagetitle"],valueField:"id",displayField:"pagetitle",baseParams:{action:"mgr/combo/resourcelist",sort:"id",dir:"asc",limit:10,combo:1},editable:1,emptyText:_("quiz_combo_resource_empty"),anchor:"100%",width:"100%",pageSize:10,allowBlank:1}),Quiz.combo.Resource.superclass.constructor.call(this,e),setTimeout(()=>{e.store.load()},1e3)},Ext.extend(Quiz.combo.Resource,Quiz.combo.ComboBoxDefault),Ext.reg("quiz-combo-resource",Quiz.combo.Resource),Quiz.combo.FieldTypes=function(e){e=e||{};var i=[[_("quiz_field_text"),"text"],[_("quiz_field_textarea"),"textarea"],[_("quiz_field_email"),"email"],[_("quiz_field_tel"),"tel"],[_("quiz_field_number"),"number"],[_("quiz_field_select"),"select"],[_("quiz_field_checkbox"),"checkbox"],[_("quiz_field_radio"),"radio"],[_("quiz_field_password"),"password"],[_("quiz_field_file"),"file"],[_("quiz_field_range"),"range"],[_("quiz_field_date"),"date"],[_("quiz_field_time"),"time"],[_("quiz_field_hidden"),"hidden"]];Ext.applyIf(e,{store:new Ext.data.ArrayStore({id:"value",fields:["display","value"],data:i}),mode:"local",displayField:"display",valueField:"value"}),Quiz.combo.FieldTypes.superclass.constructor.call(this,e)},Ext.extend(Quiz.combo.FieldTypes,MODx.combo.ComboBox),Ext.reg("quiz-combo-form-field-types",Quiz.combo.FieldTypes),Quiz.combo.Form=function(e){e=e||{},Ext.applyIf(e,{url:Quiz.config.connectorUrl,name:"formname",hiddenName:e.name,id:Ext.id(),fieldLabel:_("forms"),fields:["id","name"],valueField:"id",displayField:"name",baseParams:{action:"mgr/form/getlist",sort:"menuindex",dir:"asc",limit:10,combo:1},editable:1,emptyText:_("quiz_combo_empty"),anchor:"100%",width:"100%",pageSize:10,allowBlank:1}),Quiz.combo.Form.superclass.constructor.call(this,e),setTimeout(()=>{e.store.load()},1e3)},Ext.extend(Quiz.combo.Form,Quiz.combo.ComboBoxDefault),Ext.reg("quiz-combo-form",Quiz.combo.Form),Quiz.panel.SuperImage=function(e){(e=e||{}).imgId=e.id||Ext.id(),Ext.isEmpty(e.source)&&(e.source=MODx.config.default_media_source),Ext.apply(e,{baseCls:"quiz-panel-image",id:e.imgId,layout:"anchor",hideMode:"offsets",items:this.getFields(e)}),Quiz.panel.SuperImage.superclass.constructor.call(this,e)},Ext.extend(Quiz.panel.SuperImage,MODx.Panel,{getFields:function(e){return[{xtype:"modx-combo-browser",name:e.name,id:e.imgId+"-input",multiple:!1,allowBlank:e.allowBlank,msgTarget:"title",source:e.source,hideSourceCombo:!0,rootVisible:e.rootVisible||!1,hideFiles:e.hideFiles||!1,allowedFileTypes:e.allowedFileTypes||"",openTo:e.openTo||"",rootId:e.source_path||"/",triggerConfig:{tag:"div",cls:"quiz-combo-btns",cn:[{tag:"div",cls:"x-form-trigger x-field-combo-list icon icon-image",trigger:"file"},{tag:"div",cls:"x-form-trigger icon icon-close",trigger:"clear"}]},onTriggerClick:function(e,i){"clear"===i.getAttribute("trigger")?(this.setValue(""),this.fireEvent("change",this)):this.__proto__.onTriggerClick.call(this)},listeners:{afterrender:e=>{setTimeout(()=>{Ext.isEmpty(e.value)||(this.getCmp("input").setValue(e.value),this.updatePreview(e.value))},500)},select:e=>{this.getCmp("input").setValue(e.fullRelativeUrl||e.url),this.updatePreview(e.fullRelativeUrl||e.url)},change:e=>{this.getCmp("input").setValue(e.value),this.updatePreview(e.getValue())}}},{xtype:"label",cls:"desc-under",text:e.panel_help,hidden:Ext.isEmpty(e.panel_help)?1:0},{anchor:"100%",html:"",bodyCssClass:"",id:e.imgId+"-preview"}]},getCmp:function(e){return Ext.getCmp(this.imgId+"-"+e)},updatePreview:function(e){this.getCmp("preview").update(Quiz.utils.previewImage(e))}}),Ext.reg("quiz-image",Quiz.panel.SuperImage),Quiz.combo.Getlist=function(e){(e=e||{}).clearBtn&&(e.triggerConfig={tag:"div",cls:"quiz-combo-btns",cn:[{tag:"div",cls:"x-form-trigger x-field-combo-list"},{tag:"div",cls:"x-form-trigger icon icon-close",trigger:"clear"}]},e.onTriggerClick=function(e,i){"clear"===i.getAttribute("trigger")?(this.setValue(""),this.fireEvent("select",this)):this.__proto__.onTriggerClick.call(this)});var i=e.displayField||"name",t=e.valueField||"id",o=e.fields||[i,t];Ext.applyIf(e,{url:Quiz.config.connectorUrl,hiddenName:e.name,id:Ext.id(),displayField:i,valueField:t,fields:o,editable:1,emptyText:_("quiz_combo_empty"),anchor:"100%",width:100,pageSize:10,allowBlank:1}),Quiz.combo.Getlist.superclass.constructor.call(this,e),setTimeout(()=>{e.store.load({params:{limit:e.pageSize}})},1e3)},Ext.extend(Quiz.combo.Getlist,Quiz.combo.ComboBoxDefault),Ext.reg("quiz-combo-getlist",Quiz.combo.Getlist),Quiz.combo.GetListMulti=function(i){var e=(i=i||{}).displayField||"name",t=i.valueField||"id",o=i.fields||[e,t],o=new Ext.data.JsonStore({fields:o,autoLoad:!0,autoDestroy:!1,root:"results",url:i.url||Quiz.config.connectorUrl,baseParams:i.baseParams||{}});Ext.applyIf(i,{xtype:"superboxselect",store:o,displayField:e,valueField:t,triggerAction:"all",extraItemCls:"x-tag",expandBtnCls:"x-form-trigger",clearBtnCls:"x-form-trigger",renderTo:Ext.getBody(),emptyText:_("quiz_combo_empty"),mode:"remote",pageSize:10,listeners:{afterrender:e=>{e.setValue(i.value)}}}),i.name+="[]",i.hiddenName=i.name,Quiz.combo.GetListMulti.superclass.constructor.call(this,i),setTimeout(()=>{i.store.load({params:{limit:i.pageSize}})},1e3)},Ext.extend(Quiz.combo.GetListMulti,Ext.ux.form.SuperBoxSelect),Ext.reg("quiz-combo-getlist-multiple",Quiz.combo.GetListMulti);